<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    /> -->
    <title>v-component</title>
    <script type="module" src="/src/main.ts"></script>
    <script src="./src/dp/dp.js"></script>
  </head>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }
  </style>
  <body style="height: 100vh; overflow: hidden">
    <q-router
      data-data='{
        "whetherToShowTab":false,
        "path": [
          { "url": "/table", "keepAlive": true, "isIframe": false ,"slotName":"table" },
          { "url": "/visualization", "keepAlive": true, "isIframe": false ,"slotName":"content" },
          { "url": "/edit", "keepAlive": true, "isIframe": false ,"slotName":"content" }
        ]
  }'
    >
      <q-table id="table" slot="table"></q-table>
      <div slot="content" style="height: 100vh; overflow: hidden; width: 100vw">
        <div
          style="
            position: absolute;
            z-index: -1;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
          "
        >
          <q-image data-data='{"src":"./src/assets/bg.png"}'></q-image>
        </div>
        <div style="position: absolute; top: 0; width: 100%">
          <q-text
            data-data='{"text":"数据可视化显示系统"}'
            style="
              text-align: center;
              font-size: 30px;
              color: white;
              line-height: 66px;
            "
          ></q-text>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 10%;
            left: 5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-text data-data='{"text":"疫情曲线"}'></q-text>
        </div>
        <div
          style="
            height: 24%;
            width: 16%;
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 10%;
            left: 5%;
          "
        >
          <q-image
            data-data='{"src":"./src/assets/1654829140850.jpg"}'
          ></q-image>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 40%;
            left: 5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-text data-data='{"text":"图谱分析"}'></q-text>
        </div>
        <div
          style="
            height: 24%;
            width: 16%;
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 40%;
            left: 5%;
          "
        >
          <q-image
            data-data='{"src":"./src/assets/1654829578132.jpg"}'
          ></q-image>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 71%;
            left: 5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-text data-data='{"text":"离散分析"}'></q-text>
        </div>
        <div
          style="
            height: 24%;
            width: 16%;
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 71%;
            left: 5%;
          "
        >
          <q-image
            data-data='{"src":"./src/assets/1654829505010.jpg"}'
          ></q-image>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 10%;
            right: 4.5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-marquee-text
            data-data='{"text":"告警数据已更新,请注意查收!!!"}'
          ></q-marquee-text>
        </div>
        <div
          style="
            height: 84.8%;
            width: 22.8%;
            position: absolute;
            left: 22%;
            top: 10%;
          "
        >
          <q-tabs
            id="tabs1"
            data-data='{"tabs":[{"title":"正态分布","id":"test1"},{"title":"GIS动态","id":"test2"}]}'
          >
            <div slot="test1" style="height: 100%; border: 2px solid #033d37">
              <q-image
                data-data='{"src":"./src/assets/1655104783919.jpg"}'
              ></q-image>
            </div>
            <div slot="test2" style="height: 100%; border: 2px solid #033d37">
              <q-image
                data-data='{"src":"./src/assets/1654853215692.png"}'
              ></q-image>
            </div>
          </q-tabs>
        </div>
        <div
          style="
            height: 30%;
            width: 50%;
            position: absolute;
            right: 4.5%;
            top: 10%;
          "
        >
          <q-tabs
            id="tabs2"
            data-data='{"tabs":[{"title":"桑基划分","id":"test1"},{"title":"GIS动态","id":"test2"}]}'
          >
            <div slot="test1" style="height: 100%; border: 2px solid #033d37">
              <q-image
                data-data='{"src":"./src/assets/1654840806851.jpg"}'
              ></q-image>
            </div>
            <div slot="test2" style="height: 100%; border: 2px solid #033d37">
              <q-image
                slot="test2"
                data-data='{"src":"./src/assets/1654853215692.png"}'
              ></q-image>
            </div>
          </q-tabs>
        </div>
        <div
          style="
            height: 54%;
            width: 50%;
            position: absolute;
            right: 4.5%;
            top: 41%;
            border: 2px solid #033d37;
          "
        >
          <q-echarts-gl></q-echarts-gl>
        </div>
      </div>
    </q-router>
  </body>
  <script>
    /**
     * 路由信息表
     */
    const eventRouter = [
      {
        eventName: "edit1",
        event: (e) => {
          console.log(`编辑:`, e);
          const results = dataProvider.updateTableInfo(e.detail.record);
          dataProvider.getTableInfo();
        },
      },
      {
        eventName: "delete1",
        event: (e) => {
          console.log(`删除:`, e);
          const results = dataProvider.deleteTableInfo(e.detail.record);
          dataProvider.getTableInfo();
        },
      },
      {
        eventName: "getTableInfo",
        event: (e) => {
          console.log(`数据:`, e);
          const { detail } = e;
          const table = document.querySelector("#table");
          if (!table) return;
          table.dataset.data = JSON.stringify(detail);
        },
      },
    ];

    eventRouter.forEach(({ eventName, event }) => {
      window.addEventListener(eventName, event);
    });

    /**
     *  dataprovider(数据提供者)
     */
    const dataProvider = {
      getTableInfo: (params) => {
        // 网络请求数据,以及数据拼装
        window.dispatchEvent(
          new CustomEvent("getTableInfo", {
            detail: tableInfo,
          })
        );
        return tableInfo;
      },
      updateTableInfo: (params) => {
        // 网络请求数据,以及数据拼装
        const target = tableInfo.dataSource.find(
          (item) => item.key === params.key
        );
        if (target) {
          Object.assign(target, params);
        }
        window.dispatchEvent(
          new CustomEvent("updateTableInfo", {
            detail: tableInfo,
          })
        );
        return tableInfo;
      },
      deleteTableInfo: (params) => {
        console.log(`删除:`, params);
        // 网络请求数据,以及数据拼装
        const index = tableInfo.dataSource.findIndex(
          (item) => item.key === params.key
        );
        if (index > -1) {
          tableInfo.dataSource.splice(index, 1);
        }
        window.dispatchEvent(
          new CustomEvent("deleteTableInfo", {
            detail: tableInfo,
          })
        );
        return tableInfo;
      },
    };

    /**
     * 页面初始化
     */
    function pageInit() {
      dataProvider.getTableInfo();
    }
    pageInit();
  </script>
</html>
