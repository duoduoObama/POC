<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    /> -->
    <title>v-component</title>
    <script type="module" src="/src/main.ts"></script>
    <script src="./src/dp/dp.js"></script>
  </head>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }
  </style>
  <body style="height: 100vh; overflow: hidden">
    <q-router
      id="router"
      data-component="true"
      data-data='{
        "whetherToShowTab":false,
        "path": [
          { "url": "/table", "keepAlive": true, "isIframe": false ,"slotName":"table" },
          { "url": "/visualization", "keepAlive": true, "isIframe": false ,"slotName":"content" },
          { "url": "/edit", "keepAlive": true, "isIframe": false ,"slotName":"content" }
        ]
  }'
    >
      <div style="position: absolute; top: 0; width: 100%" slot="table">
        <q-text
          id="drag-741zj09acbdc"
          data-component="true"
          data-data='{"text":"数据可视化显示系统"}'
          style="
            text-align: center;
            font-size: 30px; 
            line-height: 66px;
          "
        ></q-text>
      </div>
      <div style="position: absolute; top: 70px; width: 100%" slot="table">
        <q-table id="drag-741zj09sxe2c" data-component="true"></q-table>
      </div>

      <div slot="content" style="height: 100vh; overflow: hidden; width: 100vw">
        <div
          style="
            position: absolute;
            z-index: -1;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
          "
        >
          <q-image data-data='{"src":"./src/assets/bg.png"}'></q-image>
        </div>
        <div style="position: absolute; top: 0; width: 100%">
          <q-text
            data-data='{"text":"数据可视化显示系统"}'
            style="
              text-align: center;
              font-size: 30px;
              color: white;
              line-height: 66px;
            "
          ></q-text>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 10%;
            left: 5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-text data-data='{"text":"疫情曲线"}'></q-text>
        </div>
        <div
          style="
            height: 24%;
            width: 16%;
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 10%;
            left: 5%;
          "
        >
          <q-image
            data-data='{"src":"./src/assets/1654829140850.jpg"}'
          ></q-image>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 40%;
            left: 5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-text data-data='{"text":"图谱分析"}'></q-text>
        </div>
        <div
          style="
            height: 24%;
            width: 16%;
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 40%;
            left: 5%;
          "
        >
          <q-image
            data-data='{"src":"./src/assets/1654829578132.jpg"}'
          ></q-image>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 71%;
            left: 5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-text data-data='{"text":"离散分析"}'></q-text>
        </div>
        <div
          style="
            height: 24%;
            width: 16%;
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 71%;
            left: 5%;
          "
        >
          <q-image
            data-data='{"src":"./src/assets/1654829505010.jpg"}'
          ></q-image>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 10%;
            right: 4.5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-marquee-text
            data-data='{"text":"告警数据已更新,请注意查收!!!"}'
          ></q-marquee-text>
        </div>
        <div
          style="
            height: 84.8%;
            width: 22.8%;
            position: absolute;
            left: 22%;
            top: 10%;
          "
        >
          <q-tabs
            id="tabs1"
            data-data='{"tabs":[{"title":"正态分布","id":"test1"},{"title":"GIS动态","id":"test2"}]}'
          >
            <div slot="test1" style="height: 100%; border: 2px solid #033d37">
              <q-image
                data-data='{"src":"./src/assets/1655104783919.jpg"}'
              ></q-image>
            </div>
            <div slot="test2" style="height: 100%; border: 2px solid #033d37">
              <q-image
                data-data='{"src":"./src/assets/1654853215692.png"}'
              ></q-image>
            </div>
          </q-tabs>
        </div>
        <div
          style="
            height: 30%;
            width: 50%;
            position: absolute;
            right: 4.5%;
            top: 10%;
          "
        >
          <q-tabs
            id="tabs2"
            data-data='{"tabs":[{"title":"桑基划分","id":"test1"},{"title":"GIS动态","id":"test2"}]}'
          >
            <div slot="test1" style="height: 100%; border: 2px solid #033d37">
              <q-image
                data-data='{"src":"./src/assets/1654840806851.jpg"}'
              ></q-image>
            </div>
            <div slot="test2" style="height: 100%; border: 2px solid #033d37">
              <q-image
                slot="test2"
                data-data='{"src":"./src/assets/1654853215692.png"}'
              ></q-image>
            </div>
          </q-tabs>
        </div>
        <div
          style="
            height: 54%;
            width: 50%;
            position: absolute;
            right: 4.5%;
            top: 41%;
            border: 2px solid #033d37;
          "
        >
          <q-echarts-gl></q-echarts-gl>
        </div>
      </div>
    </q-router>
    <q-router-config
      data-data='{"id":"drag-v6vxvmr9d29f","text":"路由配置表","group":"数据源","width":150,"height":150,"x":"0","y":"0","create_time":"2020-11-12 10:54:06","image":"","datatype":1,"options":[{"title":"table-text","target":"drag-741zj09sxe2c","trigger":["delete","edit"],"receive":[{"source":"drag-741zj09acbdc","event":["changeData"],"script":"\n    /**\n    * @params data 为发起组件绑定数据\n    * @params eventData 触发节点信息\n    * @params node 为发起组件的发起节点信息（如果发起组件有多个发起节点则有信息，如果无多个发起节点则为空值）\n    * @params title 为当前路由配置项名称\n    * convertData 用于输出数据 \n    **/\n\n    try {\n      // 自定义处理方法\n      var convertData = data\n      return convertData.name;\n    } catch (error) {\n      // 脚本错误提示，勿动!!!\n      alert(&apos;(&apos; + title + &apos;):路由数据脚本出错，请检查脚本~~~&apos;);\n      console.log(&apos;%c (&apos; + title + &apos;):路由数据脚本出错，请检查脚本~~~&apos;,&apos;font-size: 16px;font-weight: 600;color: red;&apos;);\n      console.log(error);\n    }\n      ","replyStatus":false,"reply":[]}],"targetNode":[]}],"style":"left: 0px; top: 0px; width: 150px; height: 150px; text-align: left; font-size: 14px; font-weight: 400; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); line-height: 24px; letter-spacing: 0px; opacity: 1; z-index: 1; position: absolute; overflow: hidden; cursor: move;","description":"拖入设计区->右侧功能区->属性->options->填写text文本组件中需要显示的文字","dynamicForm":{"options":[{"visible":true,"element":"custom","eleType":"q-router-config-set","disabled":false}],"info":[{"key":"id","title":"组件id","default":"","visible":true,"element":"input","eleType":"textarea","disabled":true},{"key":"text","title":"组件名称","default":"菜单导航","visible":true,"element":"input","eleType":"textarea","disabled":true},{"key":"group","title":"组件类型","default":"导航","visible":true,"element":"input","eleType":"textarea","disabled":true}],"style":[{"key":"left","title":"x轴坐标","default":0,"visible":true,"element":"input","eleType":"number","disabled":false},{"key":"top","title":"y轴坐标","default":0,"visible":true,"element":"input","eleType":"number","disabled":false},{"key":"width","title":"宽度","default":450,"visible":true,"element":"input","eleType":"number","disabled":false},{"key":"height","title":"高度","default":50,"visible":true,"element":"input","eleType":"number","disabled":false},{"key":"fontSize","title":"字体大小","default":14,"visible":true,"element":"input","eleType":"number","disabled":false},{"key":"fontWeight","title":"字体粗细","default":400,"visible":true,"element":"input","eleType":"number","disabled":false},{"key":"backgroundColor","title":"背景颜色","default":"rgb(255,255,255)","visible":true,"element":"input","eleType":"text","disabled":false},{"key":"color","title":"字体颜色","default":"rgb(0,0,0)","visible":true,"element":"input","eleType":"text","disabled":false},{"key":"lineHeight","title":"行高","default":24,"visible":true,"element":"input","eleType":"number","disabled":false},{"key":"letterSpacing","title":"字符间距","default":0,"visible":true,"element":"input","eleType":"number","disabled":false},{"key":"opacity","title":"透明度","default":1,"visible":true,"element":"input","eleType":"number","disabled":false},{"key":"zIndex","title":"组件层级","default":1,"visible":true,"element":"input","eleType":"number","disabled":false}]},"paramList":[],"componentName":"q-router-config","_id":"18130714","origin":"http://192.168.21.92:6086","events":{}}'
      data-component="true"
      id="drag-v6vxvmr9d29f"
      title="undefined"
      data-parent-id="inner-dropzone"
      data-x="0"
      data-y="0"
    ></q-router-config>
  </body>
  <!-- <body style="height: 100vh; overflow: hidden">
    <q-data-source
      data-data='{
        "dataSource":[{"requestType":"fetch","sourceId":"GET","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"https://api.apiopen.top/api/getHaoKanVideo","type":"default"},"requestParam":{"value":[{"key":"page","value":"0","type":"default"},{"key":"size","value":"5","type":"default"}],"type":"default"},"requestMethod":{"value":"GET","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"},{"key":"handleSuccess","title":"请求成功对结果的处理函数","value":"function() { return true; }"}]},{"requestType":"fetch","sourceId":"POST","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"http://jsonplaceholder.typicode.com/posts","type":"default"},"requestParam":{"value":[],"type":"default"},"requestMethod":{"value":"POST","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"},{"key":"handleSuccess","title":"请求成功对结果的处理函数","value":"function() { return true; }"}]},{"requestType":"fetch","sourceId":"PUT","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"http://jsonplaceholder.typicode.com/posts/1","type":"default"},"requestParam":{"value":[],"type":"default"},"requestMethod":{"value":"PUT","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"},{"key":"handleSuccess","title":"请求成功对结果的处理函数","value":"function() { return true; }"}]},{"requestType":"fetch","sourceId":"PATCH","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"http://jsonplaceholder.typicode.com/posts/1","type":"default"},"requestParam":{"value":[],"type":"default"},"requestMethod":{"value":"PATCH","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"},{"key":"handleSuccess","title":"请求成功对结果的处理函数","value":"function() { return true; }"}]},{"requestType":"fetch","sourceId":"DELETE","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"http://jsonplaceholder.typicode.com/posts/1","type":"default"},"requestParam":{"value":[],"type":"default"},"requestMethod":{"value":"DELETE","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"},{"key":"handleSuccess","title":"请求成功对结果的处理函数","value":"function() { return true; }"}]},{"requestType":"jsonp","sourceId":"JSONP","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"https://jsonplaceholder.typicode.com/todos/1","type":"default"},"requestParam":{"value":[{"key":"user","value":"username","type":"default"}],"type":"default"},"requestMethod":{"value":"GET","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[{"key":"user","value":"username","type":"default"}],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"}]}]
      }'
    ></q-data-source>
  </body> -->
  <script>
    /**
     * 路由信息表
     */
    const eventRouter = [
      {
        eventName: "edit1",
        event: (e) => {
          console.log(`编辑:`, e);
          const results = dataProvider.updateTableInfo(e.detail.record);
          dataProvider.getTableInfo();
        },
      },
      {
        eventName: "delete1",
        event: (e) => {
          console.log(`删除:`, e);
          const results = dataProvider.deleteTableInfo(e.detail.record);
          dataProvider.getTableInfo();
        },
      },
      {
        eventName: "getTableInfo",
        event: (e) => {
          console.log(`数据:`, e);
          const { detail } = e;
          const table = document.querySelector("#drag-741zj09sxe2c");
          if (!table) return;
          table.dataset.data = JSON.stringify(detail);
        },
      },
    ];

    eventRouter.forEach(({ eventName, event }) => {
      window.addEventListener(eventName, event);
    });

    /**
     *  dataprovider(数据提供者)
     */
    const dataProvider = {
      getTableInfo: (params) => {
        // 网络请求数据,以及数据拼装
        window.dispatchEvent(
          new CustomEvent("getTableInfo", {
            detail: tableInfo,
          })
        );
        return tableInfo;
      },
      updateTableInfo: (params) => {
        // 网络请求数据,以及数据拼装
        const target = tableInfo.dataSource.find(
          (item) => item.key === params.key
        );
        if (target) {
          Object.assign(target, params);
        }
        window.dispatchEvent(
          new CustomEvent("updateTableInfo", {
            detail: tableInfo,
          })
        );
        return tableInfo;
      },
      deleteTableInfo: (params) => {
        console.log(`删除:`, params);
        // 网络请求数据,以及数据拼装
        const index = tableInfo.dataSource.findIndex(
          (item) => item.key === params.key
        );
        if (index > -1) {
          tableInfo.dataSource.splice(index, 1);
        }
        window.dispatchEvent(
          new CustomEvent("deleteTableInfo", {
            detail: tableInfo,
          })
        );
        return tableInfo;
      },
    };

    /**
     * 页面初始化
     */
    function pageInit() {
      dataProvider.getTableInfo();
    }
    pageInit();
  </script>
  <script type="module">
    import { getElementTree } from "/src/util/utils.ts";
    import { eventBusSubscribe } from "/src/util/event-bus";

    eventBusSubscribe();
  </script>
</html>
