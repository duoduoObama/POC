<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    /> -->
    <title>v-component</title>
    <script type="module" src="/src/main.ts"></script>
    <script src="./src/dp/dp.js"></script>
  </head>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }
  </style>
  <body style="height: 100vh; overflow: hidden">
    <q-router
      id="router"
      data-component="true"
      data-data='{
        "whetherToShowTab":false,
        "path": [
          { "url": "/table", "keepAlive": true, "isIframe": false ,"slotName":"table" },
          { "url": "/visualization", "keepAlive": true, "isIframe": false ,"slotName":"content" },
          { "url": "/edit", "keepAlive": true, "isIframe": false ,"slotName":"content" }
        ]
  }'
    >
      <div style="position: absolute; top: 0; width: 100%" slot="table">
        <q-text
          id="drag-741zj09acbdc"
          data-component="true"
          data-data='{"text":"数据可视化显示系统"}'
          style="text-align: center; font-size: 30px; line-height: 66px"
        ></q-text>
      </div>
      <div style="position: absolute; top: 70px; width: 100%" slot="table">
        <q-table id="drag-741zj09sxe2c" data-component="true"></q-table>
      </div>
      <div
        style="
          position: absolute;
          top: 70px;
          width: 100%;
          z-index: 2;
          background-color: white;
        "
        slot="table"
      >
        <q-router-config
          data-data='{"test":123,"router":[{"title":"table-text","target":"drag-741zj09sxe2c","trigger":["delete","edit"],"receive":[{"source":"drag-741zj09acbdc","event":["changeData"],"script":"function() { return data; }","replyStatus":false,"reply":[]}],"targetNode":[]}]}'
          data-component="true"
          id="drag-v6vxvmr9d29f"
          title="undefined"
          data-parent-id="inner-dropzone"
          data-x="0"
          data-y="0"
        ></q-router-config>
      </div>

      <div slot="content" style="height: 100vh; overflow: hidden; width: 100vw">
        <div
          style="
            position: absolute;
            z-index: -1;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
          "
        >
          <q-image data-data='{"src":"./src/assets/bg.png"}'></q-image>
        </div>
        <div style="position: absolute; top: 0; width: 100%">
          <q-text
            data-data='{"text":"数据可视化显示系统"}'
            style="
              text-align: center;
              font-size: 30px;
              color: white;
              line-height: 66px;
            "
          ></q-text>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 10%;
            left: 5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-text data-data='{"text":"疫情曲线"}'></q-text>
        </div>
        <div
          style="
            height: 24%;
            width: 16%;
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 10%;
            left: 5%;
          "
        >
          <q-image
            data-data='{"src":"./src/assets/1654829140850.jpg"}'
          ></q-image>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 40%;
            left: 5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-text data-data='{"text":"图谱分析"}'></q-text>
        </div>
        <div
          style="
            height: 24%;
            width: 16%;
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 40%;
            left: 5%;
          "
        >
          <q-image
            data-data='{"src":"./src/assets/1654829578132.jpg"}'
          ></q-image>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 71%;
            left: 5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-text data-data='{"text":"离散分析"}'></q-text>
        </div>
        <div
          style="
            height: 24%;
            width: 16%;
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 71%;
            left: 5%;
          "
        >
          <q-image
            data-data='{"src":"./src/assets/1654829505010.jpg"}'
          ></q-image>
        </div>
        <div
          style="
            position: absolute;
            overflow: hidden;
            border: 2px solid #033d37;
            top: 10%;
            right: 4.5%;
            color: #08aa99;
            z-index: 1;
          "
        >
          <q-marquee-text
            data-data='{"text":"告警数据已更新,请注意查收!!!"}'
          ></q-marquee-text>
        </div>
        <div
          style="
            height: 84.8%;
            width: 22.8%;
            position: absolute;
            left: 22%;
            top: 10%;
          "
        >
          <q-tabs
            id="tabs1"
            data-data='{"tabs":[{"title":"正态分布","id":"test1"},{"title":"GIS动态","id":"test2"}]}'
          >
            <div slot="test1" style="height: 100%; border: 2px solid #033d37">
              <q-image
                data-data='{"src":"./src/assets/1655104783919.jpg"}'
              ></q-image>
            </div>
            <div slot="test2" style="height: 100%; border: 2px solid #033d37">
              <q-image
                data-data='{"src":"./src/assets/1654853215692.png"}'
              ></q-image>
            </div>
          </q-tabs>
        </div>
        <div
          style="
            height: 30%;
            width: 50%;
            position: absolute;
            right: 4.5%;
            top: 10%;
          "
        >
          <q-tabs
            id="tabs2"
            data-data='{"tabs":[{"title":"桑基划分","id":"test1"},{"title":"GIS动态","id":"test2"}]}'
          >
            <div slot="test1" style="height: 100%; border: 2px solid #033d37">
              <q-image
                data-data='{"src":"./src/assets/1654840806851.jpg"}'
              ></q-image>
            </div>
            <div slot="test2" style="height: 100%; border: 2px solid #033d37">
              <q-image
                slot="test2"
                data-data='{"src":"./src/assets/1654853215692.png"}'
              ></q-image>
            </div>
          </q-tabs>
        </div>
        <div
          style="
            height: 54%;
            width: 50%;
            position: absolute;
            right: 4.5%;
            top: 41%;
            border: 2px solid #033d37;
          "
        >
          <q-echarts-gl></q-echarts-gl>
        </div>
      </div>
    </q-router>
  </body>
  <!-- <body style="height: 100vh; overflow: hidden">
    <q-data-source
      data-data='{
        "dataSource":[{"requestType":"fetch","sourceId":"GET","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"https://api.apiopen.top/api/getHaoKanVideo","type":"default"},"requestParam":{"value":[{"key":"page","value":"0","type":"default"},{"key":"size","value":"5","type":"default"}],"type":"default"},"requestMethod":{"value":"GET","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"},{"key":"handleSuccess","title":"请求成功对结果的处理函数","value":"function() { return true; }"}]},{"requestType":"fetch","sourceId":"POST","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"http://jsonplaceholder.typicode.com/posts","type":"default"},"requestParam":{"value":[],"type":"default"},"requestMethod":{"value":"POST","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"},{"key":"handleSuccess","title":"请求成功对结果的处理函数","value":"function() { return true; }"}]},{"requestType":"fetch","sourceId":"PUT","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"http://jsonplaceholder.typicode.com/posts/1","type":"default"},"requestParam":{"value":[],"type":"default"},"requestMethod":{"value":"PUT","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"},{"key":"handleSuccess","title":"请求成功对结果的处理函数","value":"function() { return true; }"}]},{"requestType":"fetch","sourceId":"PATCH","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"http://jsonplaceholder.typicode.com/posts/1","type":"default"},"requestParam":{"value":[],"type":"default"},"requestMethod":{"value":"PATCH","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"},{"key":"handleSuccess","title":"请求成功对结果的处理函数","value":"function() { return true; }"}]},{"requestType":"fetch","sourceId":"DELETE","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"http://jsonplaceholder.typicode.com/posts/1","type":"default"},"requestParam":{"value":[],"type":"default"},"requestMethod":{"value":"DELETE","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"},{"key":"handleSuccess","title":"请求成功对结果的处理函数","value":"function() { return true; }"}]},{"requestType":"jsonp","sourceId":"JSONP","autoRequest":{"value":true,"type":"default"},"requestUrl":{"value":"https://jsonplaceholder.typicode.com/todos/1","type":"default"},"requestParam":{"value":[{"key":"user","value":"username","type":"default"}],"type":"default"},"requestMethod":{"value":"GET","type":"default"},"crossDomain":{"value":"false","type":"js"},"timeout":{"value":5000,"type":"default"},"requestHeader":{"value":[{"key":"user","value":"username","type":"default"}],"type":"default"},"eventHandler":[{"key":"isRequest","title":"是否发起请求的计算函数","value":"function() { return true; }"}]}]
      }'
    ></q-data-source>
  </body> -->
  <script>
    /**
     * 路由信息表
     */
    const eventRouter = [
      {
        eventName: "edit1",
        event: (e) => {
          console.log(`编辑:`, e);
          const results = dataProvider.updateTableInfo(e.detail.record);
          dataProvider.getTableInfo();
        },
      },
      {
        eventName: "delete1",
        event: (e) => {
          console.log(`删除:`, e);
          const results = dataProvider.deleteTableInfo(e.detail.record);
          dataProvider.getTableInfo();
        },
      },
      {
        eventName: "getTableInfo",
        event: (e) => {
          console.log(`数据:`, e);
          const { detail } = e;
          const table = document.querySelector("#drag-741zj09sxe2c");
          if (!table) return;
          table.dataset.data = JSON.stringify(detail);
        },
      },
    ];

    eventRouter.forEach(({ eventName, event }) => {
      window.addEventListener(eventName, event);
    });

    /**
     *  dataprovider(数据提供者)
     */
    const dataProvider = {
      getTableInfo: (params) => {
        // 网络请求数据,以及数据拼装
        window.dispatchEvent(
          new CustomEvent("getTableInfo", {
            detail: tableInfo,
          })
        );
        return tableInfo;
      },
      updateTableInfo: (params) => {
        // 网络请求数据,以及数据拼装
        const target = tableInfo.dataSource.find(
          (item) => item.key === params.key
        );
        if (target) {
          Object.assign(target, params);
        }
        window.dispatchEvent(
          new CustomEvent("updateTableInfo", {
            detail: tableInfo,
          })
        );
        return tableInfo;
      },
      deleteTableInfo: (params) => {
        console.log(`删除:`, params);
        // 网络请求数据,以及数据拼装
        const index = tableInfo.dataSource.findIndex(
          (item) => item.key === params.key
        );
        if (index > -1) {
          tableInfo.dataSource.splice(index, 1);
        }
        window.dispatchEvent(
          new CustomEvent("deleteTableInfo", {
            detail: tableInfo,
          })
        );
        return tableInfo;
      },
    };

    /**
     * 页面初始化
     */
    function pageInit() {
      dataProvider.getTableInfo();
    }
    pageInit();
  </script>
  <script type="module">
    import { getElementTree } from "/src/util/utils.ts";
    import { eventBusSubscribe } from "/src/util/event-bus";

    eventBusSubscribe();
  </script>
</html>
